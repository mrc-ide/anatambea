<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using MAMASANTE to Reconstruct Transmission Patterns: A Vignette • mamasante</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using MAMASANTE to Reconstruct Transmission Patterns: A Vignette">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mamasante</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/mamasante_intro.html">Using MAMASANTE to Reconstruct Transmission Patterns: A Vignette</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jt-hicks/mamasante/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Using MAMASANTE to Reconstruct Transmission Patterns: A Vignette</h1>
            
            <h4 data-toc-skip class="date">2025-02-07</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jt-hicks/mamasante/blob/main/vignettes/mamasante_intro.Rmd" class="external-link"><code>vignettes/mamasante_intro.Rmd</code></a></small>
      <div class="d-none name"><code>mamasante_intro.Rmd</code></div>
    </div>

    
    
<p>In this vignette, we demonstrate how to use MAMASANTE to reconstruct
patterns of transmission intensity, seasonality, and malaria burden in
settings where women are screened for malaria (using either rapid
diagnostic tests or slide microscopy) with data available at a monthly
cadence. Later vignettes will explore scenarios involving different data
cadences or stratifications (e.g., by gravidity).</p>
<div class="section level2">
<h2 id="understanding-our-approach">Understanding our approach<a class="anchor" aria-label="anchor" href="#understanding-our-approach"></a>
</h2>
<p>MAMASANTE is a tool designed to integrate Dust, Odin, and MCState
frameworks for fitting a semi-stochastic mechanistic disease
transmission model to continuously collected prevalence data using
particle Markov chain Monte Carlo (pMCMC). This package specifically
fits a semi-stochastic version of the ‘malariasimulation’ model to
monthly malaria prevalence among pregnant women at their first antenatal
care (ANC1) visit. This vignette walks through a simple example and
outlines various configurable options and settings.</p>
<p>In the deterministic version of ‘malariasimulation’, seasonal
variation in malaria transmission intensity is governed by a Fourier
series, with coefficients pre-estimated from historical rainfall data.
While this method provides reasonable seasonal profiles for fitting
cross-sectional data collected at multi-year intervals (such as data
from Demographic Health Surveys or Malaria Indicator Surveys), it lacks
the flexibility required for fitting models to monthly prevalence data
collected through ANC1.</p>
<p>To enhance flexibility, we replaced the deterministic seasonal
mechanism with a stochastic process. Specifically, mosquito emergence
rates now vary according to a random-walk process, where the monthly
change in mosquito emergence rate is modelled as: Emergence rate change
= <em>δ</em>∼<em>N</em>(0,<em>σ</em>).</p>
<p>Here, <em>σ</em> is a volatility constant, and <em>β</em>, the
mosquito emergence rate, is constrained by an upper limit <em>βmax</em>
to maintain realism. The pMCMC filters likely emergence rate
trajectories by comparing the observed prevalence with the model’s
estimated prevalence based on these trajectories. The output is a
posterior distribution of plausible model trajectories.</p>
<p>Since the relationship between mosquito emergence rates and infection
prevalence is encoded within the mechanistic model, MAMASANTE allows us
to infer trends in key indicators like the entomological inoculation
rate (EIR) and clinical incidence, which are otherwise challenging to
measure directly.</p>
</div>
<div class="section level2">
<h2 id="generating-a-test-dataset">Generating a test dataset<a class="anchor" aria-label="anchor" href="#generating-a-test-dataset"></a>
</h2>
<p>At its core, our approach leverages the established relationships
between temporal infection prevalence dynamics, transmission, and
clinical burden, as defined in the malariasimulation model.
Consequently, we can validate the inferential framework by generating
simulated datasets from the model and verifying that MAMASANTE correctly
recaptures the underlying seasonal dynamics.</p>
<p>For this vignette, we use a simulation based on rainfall patterns in
Tanga, Tanzania, where rainfall follows a characteristic bimodal
pattern. This includes:</p>
<ol style="list-style-type: decimal">
<li>A short rainy season (March–May)</li>
<li>A longer rainy season (November–January)</li>
<li>An extended dry season (June–October)</li>
</ol>
<p>Bimodal rainfall patterns, such as those in Tanga, often present a
challenging inferential problem for many algorithms attempting to
estimate seasonality. However, by applying MAMASANTE, we aim to
recapture these complex dynamics without supplying the model with prior
information about the simulation parameters.</p>
<p>The resulting relationship between malaria prevalence, clinical
incidence, and EIR in Tanga, Tanzania is illustrated below:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">combined_ggplot_true</span></span></code></pre></div>
<p><img src="images%2Funnamed-chunk-2-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="input-data">Input Data<a class="anchor" aria-label="anchor" href="#input-data"></a>
</h2>
<p>Data for fitting should be a data frame with at least three
columns:</p>
<ol style="list-style-type: decimal">
<li>
<code>month</code>: Month (here formatted as ‘yearmon’, provided by
the package ‘zoo’)</li>
<li>
<code>tested</code>:The number of individuals tested</li>
<li>
<code>positive</code>: Of those tested, the number of positive test
results</li>
</ol>
<p>In our example “tanga_data_slim” samples in the correct format have
been generated by sampling binomially from infection prevalence from the
simulation presented above.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">tanga_data_slim</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt;      month positive tested</span></span>
<span><span class="co">#&gt; 1 Jan 2017      204   1000</span></span>
<span><span class="co">#&gt; 2 Feb 2017      224   1000</span></span>
<span><span class="co">#&gt; 3 Mar 2017      234   1000</span></span>
<span><span class="co">#&gt; 4 Apr 2017      256   1000</span></span>
<span><span class="co">#&gt; 5 May 2017      284   1000</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="running-a-pmcmc-fitting">Running a pMCMC fitting<a class="anchor" aria-label="anchor" href="#running-a-pmcmc-fitting"></a>
</h2>
<p>The <code>run_pmcmc</code> function is the central tool to fit our
model to observed data. It formats the provided data set, sets up
required functions and parameters, and finally runs the pMCMC. Broadly,
the flow of actions is as follows:</p>
<ol style="list-style-type: decimal">
<li>Process provided data set, specifically formatting necessary time
variables.</li>
<li>Format and declare parameters. These include both constant or known
parameter values needed for malariasimulation as well as pMCMC
parameters that will be fit.</li>
<li>Set particle filter and pMCMC settings.</li>
<li>Run the pMCMC.</li>
<li>Format output.</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">mamasante</span><span class="fu">::</span><span class="fu"><a href="../reference/run_pmcmc.html">run_pmcmc</a></span><span class="op">(</span>data_raw<span class="op">=</span><span class="va">tanga_data_slim</span>,</span>
<span>                       n_particles<span class="op">=</span><span class="fl">100</span>,</span>
<span>                       target_prev <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>                       n_steps <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; /home/runner/work/_temp/Library/mamasante/extdata//admin_units_seasonal.rds</span></span>
<span><span class="co">#&gt; /home/runner/work/_temp/Library/mamasante/extdata//pgsgmg_corr_sample.rds</span></span>
<span><span class="co">#&gt; /home/runner/work/_temp/Library/mamasante/extdata//all_corr_sample.RDS</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="color: #00BBBB;">R CMD INSTALL</span> <span style="color: #00BBBB;">───────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; * installing *source* package ‘odin.model.stripped.seasonal9f89af4b’ ...</span></span>
<span><span class="co">#&gt; ** using staged installation</span></span>
<span><span class="co">#&gt; ** libs</span></span>
<span><span class="co">#&gt; using C compiler: ‘gcc (Ubuntu 13.3.0-6ubuntu2~24.04) 13.3.0’</span></span>
<span><span class="co">#&gt; gcc -I"/opt/R/4.4.2/lib/R/include" -DNDEBUG   -I/usr/local/include    -fpic  -g -O2  -UNDEBUG -Wall -pedantic -g -O0 -fdiagnostics-color=always -c odin.c -o odin.o</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">odin.c:</span> In function ‘<span style="font-weight: bold;">odin_model_stripped_seasonal_initial_conditions</span>’:</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">odin.c:2286:10:</span> <span style="color: #BB00BB; font-weight: bold;">warning: </span>unused variable ‘<span style="font-weight: bold;">t</span>’ [<span style="color: #BB00BB; font-weight: bold;">-Wunused-variable</span>]</span></span>
<span><span class="co">#&gt;  2286 |   double <span style="color: #BB00BB; font-weight: bold;">t</span> = scalar_real(t_ptr, "t");</span></span>
<span><span class="co">#&gt;       |          <span style="color: #BB00BB; font-weight: bold;">^</span></span></span>
<span><span class="co">#&gt; gcc -I"/opt/R/4.4.2/lib/R/include" -DNDEBUG   -I/usr/local/include    -fpic  -g -O2  -UNDEBUG -Wall -pedantic -g -O0 -fdiagnostics-color=always -c registration.c -o registration.o</span></span>
<span><span class="co">#&gt; gcc -shared -L/opt/R/4.4.2/lib/R/lib -L/usr/local/lib -o odin.model.stripped.seasonal9f89af4b.so odin.o registration.o -L/opt/R/4.4.2/lib/R/lib -lR</span></span>
<span><span class="co">#&gt; installing to /tmp/Rtmp1ymgZG/devtools_install_227f715e6489/00LOCK-file227f2e7469aa/00new/odin.model.stripped.seasonal9f89af4b/libs</span></span>
<span><span class="co">#&gt; ** checking absolute paths in shared objects and dynamic libraries</span></span>
<span><span class="co">#&gt; * DONE (odin.model.stripped.seasonal9f89af4b)</span></span>
<span><span class="co">#&gt; Unused equation: mu0</span></span>
<span><span class="co">#&gt;  mu0 &lt;- user() # baseline mosquito death rate # (line 323)</span></span>
<span><span class="co">#&gt; Optimizing initial EIR based on target prevalence.</span></span>
<span><span class="co">#&gt; Initial EIR set to 29.3.</span></span>
<span><span class="co">#&gt; Running chain 1 / 1</span></span>
<span><span class="co">#&gt; Finished 10 steps in 49 secs</span></span>
<span><span class="co">#&gt; Time difference of 53.70398 secs</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visualising-output">Visualising output<a class="anchor" aria-label="anchor" href="#visualising-output"></a>
</h2>
<p>We can then visualise how well the pMCMC fit to the prevalence data,
as well as unobserved transmission metrics like clinical incidence in
the entire population and the entomological inoculation rate (EIR).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span><span class="op">$</span><span class="va">output</span></span></code></pre></div>
<p><img src="images%2Funnamed-chunk-4-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Joseph Hicks.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
